## Lingering Effect Simulation


### Setup

1. eQTL data from GTEx muscle_sketal tissue including 39 gene identified around the top GWAS hit of Standing Height trait. PTWAS DB is extracted from the full GTEx DB. 
2. GWAS trait is simulated by a single causal SNP
3. run PTWAS scan procedure
```
perl PTWAS_scan/run_PTWAS_scan.pl sim_gwas/sim.gwas.summary
```
4. summarize PTWAS result
```
sh PTWAS_scan/summize.sh
```
Two gene-level TWAS scan result files: ```PTWAS_scan.before.rst``` (using original simulated GWAS phenotype) and ```PTWAS_scan.after.rst``` (using residual of simulated GWAS phenotype after controlling the causal SNP). Both files are saved in ```PTWAS_scan``` directory. 




### Data simulation

The sole causal SNP for GWAS is  chr3_141402972_A_C. We fix its effect size to -1.5 (rather large). The SNP is annotated in the following genes in Muscle_Skeletal(tissue code 33): ENSG00000177311.11

In TWAS scan of UKB heights, a cluster of TWAS associations around the following gene:
```
ENSG00000177311	chr3	141269948-141565541	ENSG00000177311.11	eQTL	Muscle_Skeletal	120	-25.219966	2.4195e-140	OK	0.007206
```


GAMBIT TWAS weight entry:
```
chr3	141402972	chr3:141402972:A:C	A	C	ENSG00000177311.11=0.00194@0;0.000399@1;2.75e-06@3;0.00422@5;1.76e-05@10;0.00664@19;0.0072@24;-0.00364@25;0.00498@26;0.00223@27;0.000259@33;0.00294@34;-0.000618@39;-0.00211@40;0.00771@42;0.000109@44;0.00385@45;0.0102@48|ENSG00000155903.11=1.07e-06@26
```



### Results

PTWAS results of all neighboring genes in Muscle_Skeletal 

Before controlling the sole causal GWAS SNP

```
chr3	133498375-133978379	ENSG00000091513.14	eQTL	Muscle_Skeletal	468	0.211563	8.3245e-01	OK
chr3	133534092-133856770	ENSG00000091527.15	eQTL	Muscle_Skeletal	140	2.586538	9.6945e-03	OK **
chr3	133570354-133712025	ENSG00000163781.12	eQTL	Muscle_Skeletal	118	0.050621	9.5963e-01	OK
chr3	133682758-133833196	ENSG00000144867.11	eQTL	Muscle_Skeletal	76	3.501020	4.6348e-04	OK ***
chr3	133865217-134105547	ENSG00000154917.10	eQTL	Muscle_Skeletal	43	1.785376	7.4200e-02	OK
chr3	133865217-134286151	ENSG00000174640.12	eQTL	Muscle_Skeletal	638	-0.653413	5.1349e-01	OK
chr3	134048379-134655050	ENSG00000114019.14	eQTL	Muscle_Skeletal	298	-2.012701	4.4146e-02	OK *
chr3	134065552-134271906	ENSG00000163785.12	eQTL	Muscle_Skeletal	99	-0.253619	7.9979e-01	OK
chr3	134304034-134359724	ENSG00000260633.1	eQTL	Muscle_Skeletal	24	0.864523	3.8730e-01	OK
chr3	134329345-134496210	ENSG00000129055.12	eQTL	Muscle_Skeletal	45	2.587399	9.6703e-03	OK **
chr3	134452129-134586026	ENSG00000182923.16	eQTL	Muscle_Skeletal	122	2.740322	6.1379e-03	OK **
chr3	137624740-138621065	ENSG00000138231.12	eQTL	Muscle_Skeletal	339	-3.104891	1.9035e-03	OK **
chr3	137703576-138527843	ENSG00000158220.13	eQTL	Muscle_Skeletal	243	0.891795	3.7250e-01	OK
chr3	138067251-138165545	ENSG00000158163.14	eQTL	Muscle_Skeletal	91	3.102024	1.9220e-03	OK **
chr3	138278900-138405272	ENSG00000181322.13	eQTL	Muscle_Skeletal	99	-1.428653	1.5310e-01	OK
chr3	138308390-138410301	ENSG00000158186.12	eQTL	Muscle_Skeletal	31	1.021833	3.0686e-01	OK 
chr3	138476687-138627987	ENSG00000114107.8	eQTL	Muscle_Skeletal	129	-2.227477	2.5915e-02	OK *
chr3	138560708-138629753	ENSG00000158234.12	eQTL	Muscle_Skeletal	57	2.881946	3.9523e-03	OK **
chr3	139086078-139519303	ENSG00000175110.11	eQTL	Muscle_Skeletal	146	-0.912873	3.6131e-01	OK 
chr3	139316765-139556140	ENSG00000248932.5	eQTL	Muscle_Skeletal	249	1.282427	1.9969e-01	OK 
chr3	139529151-139556600	ENSG00000114115.9	eQTL	Muscle_Skeletal	52	-2.810170	4.9515e-03	OK **
chr3	140399388-141484807	ENSG00000175093.4	eQTL	Muscle_Skeletal	608	2.669110	7.6053e-03	OK **
chr3	141190219-141288879	ENSG00000155893.12	eQTL	Muscle_Skeletal	77	3.145786	1.6564e-03	OK ** 
chr3	141269948-141565541	ENSG00000177311.11	eQTL	Muscle_Skeletal	120	-16.569814	1.1518e-61	OK ******
chr3	141685796-141799976	ENSG00000114124.2	eQTL	Muscle_Skeletal	26	-2.631818	8.4929e-03	OK ** 
chr3	141712121-141771318	ENSG00000114125.13	eQTL	Muscle_Skeletal	85	-0.141443	8.8752e-01	OK
chr3	141755509-142323973	ENSG00000175066.15	eQTL	Muscle_Skeletal	468	-0.765472	4.4399e-01	OK
chr3	141836784-142311385	ENSG00000120756.12	eQTL	Muscle_Skeletal	154	-0.434809	6.6370e-01	OK
chr3	141857990-142088593	ENSG00000069849.10	eQTL	Muscle_Skeletal	75	-0.100316	9.2009e-01	OK
chr3	141972652-142323973	ENSG00000114127.10	eQTL	Muscle_Skeletal	80	-2.259811	2.3833e-02	OK * 
chr3	142283944-142323973	ENSG00000175054.14	eQTL	Muscle_Skeletal	15	-1.185348	2.3588e-01	OK 
chr3	142972042-143295865	ENSG00000163710.7	eQTL	Muscle_Skeletal	13	-6.531232	6.5231e-11	OK ****
chr3	143117286-143144722	ENSG00000175040.5	eQTL	Muscle_Skeletal	41	-1.123035	2.6142e-01	OK *
chr3	143818553-144256194	ENSG00000181744.8	eQTL	Muscle_Skeletal	446	-0.106143	9.1547e-01	OK 
chr3	146042455-146174924	ENSG00000261051.1	eQTL	Muscle_Skeletal	196	2.337906	1.9392e-02	OK *
chr3	146065619-146596015	ENSG00000279320.1	eQTL	Muscle_Skeletal	376	2.326524	1.9991e-02	OK *
chr3	146067919-146183297	ENSG00000152952.11	eQTL	Muscle_Skeletal	66	0.387571	6.9833e-01	OK
chr3	146206845-146344951	ENSG00000114698.14	eQTL	Muscle_Skeletal	127	-0.906773	3.6453e-01	OK
chr3	146473868-146564529	ENSG00000188313.12	eQTL	Muscle_Skeletal	113	3.176873	1.4887e-03	OK **

```


After controlling for the effect SNP

```
chr3	133498375-133978379	ENSG00000091513.14	eQTL	Muscle_Skeletal	468	-0.302450	7.6231e-01	OK
chr3	133534092-133856770	ENSG00000091527.15	eQTL	Muscle_Skeletal	140	-0.161606	8.7162e-01	OK
chr3	133570354-133712025	ENSG00000163781.12	eQTL	Muscle_Skeletal	118	0.250245	8.0240e-01	OK
chr3	133682758-133833196	ENSG00000144867.11	eQTL	Muscle_Skeletal	76	-0.441898	6.5856e-01	OK
chr3	133865217-134105547	ENSG00000154917.10	eQTL	Muscle_Skeletal	43	-0.826299	4.0863e-01	OK
chr3	133865217-134286151	ENSG00000174640.12	eQTL	Muscle_Skeletal	638	1.436662	1.5081e-01	OK
chr3	134048379-134655050	ENSG00000114019.14	eQTL	Muscle_Skeletal	298	0.140937	8.8792e-01	OK
chr3	134065552-134271906	ENSG00000163785.12	eQTL	Muscle_Skeletal	99	-0.229714	8.1831e-01	OK
chr3	134304034-134359724	ENSG00000260633.1	eQTL	Muscle_Skeletal	24	-0.463701	6.4286e-01	OK
chr3	134329345-134496210	ENSG00000129055.12	eQTL	Muscle_Skeletal	45	-0.050544	9.5969e-01	OK
chr3	134452129-134586026	ENSG00000182923.16	eQTL	Muscle_Skeletal	122	-0.019390	9.8453e-01	OK
chr3	137624740-138621065	ENSG00000138231.12	eQTL	Muscle_Skeletal	339	0.648401	5.1673e-01	OK
chr3	137703576-138527843	ENSG00000158220.13	eQTL	Muscle_Skeletal	243	-1.398581	1.6194e-01	OK
chr3	138067251-138165545	ENSG00000158163.14	eQTL	Muscle_Skeletal	91	0.214461	8.3019e-01	OK
chr3	138278900-138405272	ENSG00000181322.13	eQTL	Muscle_Skeletal	99	-0.135549	8.9218e-01	OK
chr3	138308390-138410301	ENSG00000158186.12	eQTL	Muscle_Skeletal	31	0.320888	7.4830e-01	OK
chr3	138476687-138627987	ENSG00000114107.8	eQTL	Muscle_Skeletal	129	1.210624	2.2604e-01	OK
chr3	138560708-138629753	ENSG00000158234.12	eQTL	Muscle_Skeletal	57	-1.355309	1.7532e-01	OK
chr3	139086078-139519303	ENSG00000175110.11	eQTL	Muscle_Skeletal	146	-1.819471	6.8840e-02	OK
chr3	139316765-139556140	ENSG00000248932.5	eQTL	Muscle_Skeletal	249	1.199255	2.3043e-01	OK
chr3	139529151-139556600	ENSG00000114115.9	eQTL	Muscle_Skeletal	52	-0.514946	6.0659e-01	OK
chr3	140399388-141484807	ENSG00000175093.4	eQTL	Muscle_Skeletal	608	0.361233	7.1793e-01	OK
chr3	141190219-141288879	ENSG00000155893.12	eQTL	Muscle_Skeletal	77	-0.597894	5.4991e-01	OK
chr3	141269948-141565541	ENSG00000177311.11	eQTL	Muscle_Skeletal	120	-0.311671	7.5529e-01	OK
chr3	141685796-141799976	ENSG00000114124.2	eQTL	Muscle_Skeletal	26	0.320664	7.4846e-01	OK
chr3	141712121-141771318	ENSG00000114125.13	eQTL	Muscle_Skeletal	85	0.054762	9.5633e-01	OK
chr3	141755509-142323973	ENSG00000175066.15	eQTL	Muscle_Skeletal	468	2.291313	2.1945e-02	OK *
chr3	141836784-142311385	ENSG00000120756.12	eQTL	Muscle_Skeletal	154	1.096950	2.7266e-01	OK
chr3	141857990-142088593	ENSG00000069849.10	eQTL	Muscle_Skeletal	75	0.110467	9.1204e-01	OK
chr3	141972652-142323973	ENSG00000114127.10	eQTL	Muscle_Skeletal	80	0.843347	3.9903e-01	OK
chr3	142283944-142323973	ENSG00000175054.14	eQTL	Muscle_Skeletal	15	-0.155327	8.7656e-01	OK
chr3	142972042-143295865	ENSG00000163710.7	eQTL	Muscle_Skeletal	13	0.868212	3.8528e-01	OK
chr3	143117286-143144722	ENSG00000175040.5	eQTL	Muscle_Skeletal	41	1.284654	1.9891e-01	OK
chr3	143818553-144256194	ENSG00000181744.8	eQTL	Muscle_Skeletal	446	1.146747	2.5149e-01	OK
chr3	146042455-146174924	ENSG00000261051.1	eQTL	Muscle_Skeletal	196	-0.599162	5.4907e-01	OK
chr3	146065619-146596015	ENSG00000279320.1	eQTL	Muscle_Skeletal	376	-1.261502	2.0713e-01	OK
chr3	146067919-146183297	ENSG00000152952.11	eQTL	Muscle_Skeletal	66	0.063430	9.4942e-01	OK
chr3	146206845-146344951	ENSG00000114698.14	eQTL	Muscle_Skeletal	127	1.022951	3.0633e-01	OK
chr3	146473868-146564529	ENSG00000188313.12	eQTL	Muscle_Skeletal	113	-1.258572	2.0818e-01	OK
```

It is very clear that all the significant findings in the previous scan are driven by the single GWAS signal.



### SMR validation


Before Test:

```
Gene            Instrument              SMR_p-value
ENSG00000177311 chr3_141345111_C_T_b38 6.49547371655179e-70
ENSG00000138231 chr3_138402850_C_G_b38 6.38320340275383e-05
ENSG00000144867 chr3_133789389_G_T_b38 0.000493088327173827
ENSG00000114124 chr3_141747305_T_C_b38 0.000559055449867209
ENSG00000158163 chr3_138115664_A_T_b38 0.00191401312411047
ENSG00000163710 chr3_143521734_A_T_b38 0.00217974848624419
ENSG00000188313 chr3_146534359_AT_A_b38 0.0025489580059449
ENSG00000114115 chr3_139546794_C_T_b38 0.00336432470638418
ENSG00000158234 chr3_138613771_C_T_b38 0.00470064984408797
ENSG00000114127 chr3_142165457_GT_G_b38 0.011347666256318
ENSG00000129055 chr3_134486229_G_T_b38 0.0144661157873341
ENSG00000261051 chr3_146085351_T_C_b38 0.0148302797691951
ENSG00000091527 chr3_133568221_A_G_b38 0.016097886763904
ENSG00000182923 chr3_134482083_A_G_b38 0.0199662628156947
ENSG00000114019 chr3_134313522_G_A_b38 0.0318657365730996
ENSG00000154917 chr3_133884636_A_G_b38 0.0484901924446015
ENSG00000155893 chr3_141258965_G_C_b38 0.0502323071850135
ENSG00000181322 chr3_138352059_C_T_b38 0.0707169457580536
ENSG00000163785 chr3_134123466_G_A_b38 0.104152695525842
ENSG00000114698 chr3_146224444_G_A_b38 0.112379085982452
ENSG00000279320 chr3_146541776_G_A_b38 0.138340978333219
ENSG00000175110 chr3_139416026_A_T_b38 0.171170500870299
ENSG00000175093 chr3_140693934_G_A_b38 0.2083135237924
ENSG00000114107 chr3_138537582_G_A_b38 0.210201819984856
ENSG00000152952 chr3_146120350_G_C_b38 0.233366010841085
ENSG00000175054 chr3_142320564_G_A_b38 0.234335918088745
ENSG00000260633 chr3_134358159_G_A_b38 0.263155034076823
ENSG00000175040 chr3_143127958_A_G_b38 0.268559209976213
ENSG00000248932 chr3_139514159_G_A_b38 0.277378659370083
ENSG00000175066 chr3_142288645_C_T_b38 0.340734621925503
ENSG00000069849 chr3_141868307_C_T_b38 0.407990410664356
ENSG00000114125 chr3_141745873_C_G_b38 0.434204766596702
ENSG00000181744 chr3_143985674_C_T_b38 0.483364621849853
ENSG00000174640 chr3_133978920_G_T_b38 0.539938725225548
ENSG00000091513 chr3_133752065_A_G_b38 0.710356947530851
ENSG00000163781 chr3_133640702_C_T_b38 0.805209830107464
ENSG00000158186 chr3_138377255_A_C_b38 0.870740879194107
ENSG00000158220 chr3_138353967_G_A_b38 0.924452986495116
ENSG00000120756 chr3_142050424_G_A_b38 0.997348517579288
```

After Test:
```
Gene            Instrument              SMR_p-value
ENSG00000175066 chr3_142288645_C_T_b38 0.733324293305543
ENSG00000120756 chr3_142050424_G_A_b38 0.866976892008397
ENSG00000181744 chr3_143985674_C_T_b38 0.896164425898816
ENSG00000174640 chr3_133978920_G_T_b38 0.897656129134885
ENSG00000248932 chr3_139514159_G_A_b38 0.923372931328182
ENSG00000158220 chr3_138353967_G_A_b38 0.92663816621584
ENSG00000138231 chr3_138402850_C_G_b38 0.928582886274365
ENSG00000175110 chr3_139416026_A_T_b38 0.931716666262853
ENSG00000114127 chr3_142165457_GT_G_b38 0.932169777963557
ENSG00000279320 chr3_146541776_G_A_b38 0.936432608941995
ENSG00000175093 chr3_140693934_G_A_b38 0.946086974510735
ENSG00000175040 chr3_143127958_A_G_b38 0.946491305238286
ENSG00000091513 chr3_133752065_A_G_b38 0.946892834887952
ENSG00000114698 chr3_146224444_G_A_b38 0.948024484160629
ENSG00000188313 chr3_146534359_AT_A_b38 0.948374740752953
ENSG00000158234 chr3_138613771_C_T_b38 0.950972049721736
ENSG00000158186 chr3_138377255_A_C_b38 0.954916694436089
ENSG00000114125 chr3_141745873_C_G_b38 0.959050660958568
ENSG00000163785 chr3_134123466_G_A_b38 0.960579046598231
ENSG00000144867 chr3_133789389_G_T_b38 0.963193065809796
ENSG00000114107 chr3_138537582_G_A_b38 0.963464719701035
ENSG00000114115 chr3_139546794_C_T_b38 0.964385050616461
ENSG00000154917 chr3_133884636_A_G_b38 0.970503460992507
ENSG00000114124 chr3_141747305_T_C_b38 0.971073032019078
ENSG00000261051 chr3_146085351_T_C_b38 0.97608490619856
ENSG00000260633 chr3_134358159_G_A_b38 0.977881053144033
ENSG00000158163 chr3_138115664_A_T_b38 0.980095478947122
ENSG00000163710 chr3_143521734_A_T_b38 0.981593491686672
ENSG00000091527 chr3_133568221_A_G_b38 0.985598989867129
ENSG00000152952 chr3_146120350_G_C_b38 0.987825258158151
ENSG00000182923 chr3_134482083_A_G_b38 0.988718710766729
ENSG00000069849 chr3_141868307_C_T_b38 0.989967639455119
ENSG00000181322 chr3_138352059_C_T_b38 0.992453849325265
ENSG00000155893 chr3_141258965_G_C_b38 0.993992065959511
ENSG00000177311 chr3_141345111_C_T_b38 0.996866768430076
ENSG00000163781 chr3_133640702_C_T_b38 0.996894767042927
ENSG00000175054 chr3_142320564_G_A_b38 0.997080626874943
ENSG00000129055 chr3_134486229_G_T_b38 0.997109158135152
ENSG00000114019 chr3_134313522_G_A_b38 0.997751978963555
```


